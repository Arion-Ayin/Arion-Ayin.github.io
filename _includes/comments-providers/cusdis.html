<div id="cusdis_thread"
  data-host="https://cusdis.com"
  data-app-id="e0d12818-fd20-436b-9147-01ff3302486e"
  data-page-id="{{ PAGE_ID }}"
  data-page-url="{{ PAGE_URL }}"
  data-page-title="{{ PAGE_TITLE }}"
  data-theme="auto"
></div>
<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

<style>
/* Cusdis Card Customization */
#cusdis_thread {
  margin-top: 2em;
}

/* Reorder layout: comments above form */
#cusdis_thread iframe {
  display: flex !important;
  flex-direction: column !important;
}

/* Comments section appears first */
#cusdis_thread .cusdis-comments,
#cusdis_thread [class*="comments"] {
  order: 1 !important;
}

/* Form appears second (below comments) */
#cusdis_thread .cusdis-form,
#cusdis_thread form,
#cusdis_thread [class*="form"] {
  order: 2 !important;
}

/* Override Cusdis default styles to create card layout */
#cusdis_thread .cusdis-comment {
  background: rgba(255, 255, 255, 0.05) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 12px !important;
  padding: 1.5em !important;
  margin-bottom: 1.5em !important;
  transition: transform 0.3s ease, box-shadow 0.3s ease !important;
  backdrop-filter: blur(10px) !important;
}

#cusdis_thread .cusdis-comment:hover {
  transform: translateY(-5px) !important;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3) !important;
  border-color: rgba(255, 255, 255, 0.2) !important;
}

/* Comment author styling */
#cusdis_thread .cusdis-comment-author {
  display: flex !important;
  align-items: center !important;
  gap: 0.75em !important;
  margin-bottom: 1em !important;
  font-weight: 600 !important;
  font-size: 1.1em !important;
}

/* Add avatar circle */
#cusdis_thread .cusdis-comment-author::before {
  content: attr(data-initial) !important;
  width: 45px !important;
  height: 45px !important;
  border-radius: 50% !important;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-size: 1.2em !important;
  font-weight: bold !important;
  color: white !important;
  flex-shrink: 0 !important;
}

/* Comment content */
#cusdis_thread .cusdis-comment-content {
  line-height: 1.6 !important;
  margin-top: 0.5em !important;
  font-size: 0.95em !important;
}

/* Comment date */
#cusdis_thread .cusdis-comment-date {
  font-size: 0.85em !important;
  opacity: 0.7 !important;
  margin-top: 0.5em !important;
}

/* Form styling */
#cusdis_thread .cusdis-form {
  background: rgba(255, 255, 255, 0.03) !important;
  border-radius: 12px !important;
  padding: 2em !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  margin-top: 2em !important;
}

#cusdis_thread input,
#cusdis_thread textarea {
  background: rgba(255, 255, 255, 0.05) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-radius: 8px !important;
  padding: 0.75em !important;
  width: 100% !important;
  margin-bottom: 1em !important;
  transition: border-color 0.3s ease !important;
}

#cusdis_thread input:focus,
#cusdis_thread textarea:focus {
  border-color: rgba(255, 255, 255, 0.3) !important;
  outline: none !important;
}

#cusdis_thread button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  border: none !important;
  border-radius: 8px !important;
  padding: 0.75em 2em !important;
  color: white !important;
  font-weight: 600 !important;
  cursor: pointer !important;
  transition: transform 0.2s ease, box-shadow 0.2s ease !important;
}

#cusdis_thread button:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
}

/* Responsive grid for comments */
@media (min-width: 768px) {
  #cusdis_thread .cusdis-comments {
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)) !important;
    gap: 1.5em !important;
  }
}
</style>

<script>
// Enhance Cusdis comments with card layout
(function() {
  // Wait for Cusdis to load
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length) {
        enhanceCusdisComments();
      }
    });
  });
  
  // Start observing
  const cusdisThread = document.getElementById('cusdis_thread');
  if (cusdisThread) {
    observer.observe(cusdisThread, { childList: true, subtree: true });
  }
  
  // Also try after page load
  window.addEventListener('load', function() {
    setTimeout(enhanceCusdisComments, 1000);
  });
  
  function enhanceCusdisComments() {
    // Find all comment authors and add initial letter
    const authors = document.querySelectorAll('#cusdis_thread .cusdis-comment-author');
    authors.forEach(function(author) {
      const name = author.textContent.trim();
      if (name && !author.hasAttribute('data-initial')) {
        author.setAttribute('data-initial', name.charAt(0).toUpperCase());
      }
    });
    
    // Reorder: move comments above form
    try {
      const iframe = document.querySelector('#cusdis_thread iframe');
      if (iframe) {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        if (iframeDoc) {
          const iframeBody = iframeDoc.body;
          
          // Find form and comments container
          const form = iframeBody.querySelector('form') || iframeBody.querySelector('[class*="form"]');
          const commentsContainer = iframeBody.querySelector('[class*="comments"]');
          
          if (form && commentsContainer && !form.hasAttribute('data-reordered')) {
            // Mark as reordered to prevent infinite loop
            form.setAttribute('data-reordered', 'true');
            
            // Move comments before form
            if (form.parentNode === commentsContainer.parentNode) {
              form.parentNode.insertBefore(commentsContainer, form);
            }
          }
        }
      }
    } catch (e) {
      // CORS restrictions or other errors
      console.log('Cannot reorder iframe content:', e);
    }
  }
})();

// Auto-adjust Cusdis iframe height to remove scrollbar
(function() {
  function adjustIframeHeight() {
    const cusdisThread = document.getElementById('cusdis_thread');
    if (!cusdisThread) return;
    
    // Find the Cusdis iframe
    const iframe = cusdisThread.querySelector('iframe');
    if (!iframe) return;
    
    try {
      // Get the content height from iframe
      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      if (iframeDoc && iframeDoc.body) {
        const contentHeight = iframeDoc.body.scrollHeight;
        if (contentHeight > 0) {
          iframe.style.height = contentHeight + 'px';
          iframe.style.overflow = 'hidden';
        }
      }
    } catch (e) {
      // Cross-origin restrictions - use alternative method
      console.log('Using alternative height detection method');
    }
  }
  
  // Observe for iframe creation
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.addedNodes.length) {
        const iframe = document.querySelector('#cusdis_thread iframe');
        if (iframe) {
          // Wait for iframe to load
          iframe.addEventListener('load', function() {
            adjustIframeHeight();
            // Re-adjust after a delay to catch dynamic content
            setTimeout(adjustIframeHeight, 500);
            setTimeout(adjustIframeHeight, 1000);
            setTimeout(adjustIframeHeight, 2000);
          });
          
          // Also observe changes inside iframe
          try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            if (iframeDoc) {
              const iframeObserver = new MutationObserver(adjustIframeHeight);
              iframeObserver.observe(iframeDoc.body, { 
                childList: true, 
                subtree: true,
                attributes: true 
              });
            }
          } catch (e) {
            // Cross-origin restrictions
            console.log('Cannot observe iframe content due to CORS');
          }
        }
      }
    });
  });
  
  const cusdisThread = document.getElementById('cusdis_thread');
  if (cusdisThread) {
    observer.observe(cusdisThread, { childList: true, subtree: true });
  }
  
  // Try on page load
  window.addEventListener('load', function() {
    setTimeout(adjustIframeHeight, 1000);
    setTimeout(adjustIframeHeight, 2000);
    setTimeout(adjustIframeHeight, 3000);
  });
})();
</script>
